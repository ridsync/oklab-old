<!DOCTYPE html>
<html >
  <head>
    <% include ../partials/head %>
    <link rel="stylesheet" href="/stylesheets/chatstyle.css">
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="/javascripts/chat.js"></script>
  </head>
  <body>
    <header>
      <% include ../partials/header %>
    </header>
      <div class="containers clearfix">
        <div class="chat">
          <div class="chat-header clearfix">
            <img src="<%= user.picture %>" alt="avatar">
            <div class="chat-about">
              <div class="chat-room"><%= room.title %></div>
              <div class="chat-num-users"> User(s)</div>
            </div>
            <i class="fa fa-users"></i>
          </div> <!-- end chat-header -->

          <div class="chat-history">
            <ul>
            </ul>
          </div> <!-- end chat-history -->

          <div class="chat-message clearfix">
            <textarea id="message" name="message" placeholder ="메세지를 여기에 적으세요." rows="3"></textarea>
            <button type="submit">Send</button>
          </div> <!-- end chat-message -->
        </div> <!-- end chat -->

        <div class="controls">
            <a href="/chat/rooms" class="logout-btn">EXIT</a>
            <a class="rooms-btn">AD</a>
        </div>

        <div class="users-list">
          <ul class="list">
          </ul>
        </div>
      </div> <!-- end container -->

    <script>
    $(function(){app.chat('<%= room.id %>', '<%= user.userName %>')});

    $('#message').keydown(function(event) {
        if (event.keyCode == '13'
                 && ! event.shiftKey) {
            event.preventDefault();
            $(".chat-message button").click();
        }
     });
    var int = 0;
     var showAlert = setInterval(function() {
       int++;
       var order = int % 6;
         var suffix = '';
         var prefix = '';
         for(var i=0; i < order; i++){
           prefix = prefix + "(";
           suffix = suffix + ")";
         }
         $('.rooms-btn').html(prefix + ' AD ' + suffix);
      }, 800);

    </script>
  </body>
</html>
